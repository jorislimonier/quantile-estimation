\documentclass{article}

\usepackage{graphicx}
\usepackage{float}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}
\hypersetup{
    colorlinks  = true,
    linkcolor   = blue,
    filecolor   = blue,      
    urlcolor    = blue,
}

\title{Student job report: Bootstrap high quantiles estimation.}
\author{Joris LIMONIER}
\date{February - May 2021}

\begin{document}
\maketitle

\tableofcontents
\newpage

\section{Introduction}
The analysis was made with the data in figure \ref{fig: initial data} which is visually represented by the histogram in figure \ref{fig: visual representation of the initial data}.

\begin{figure}[H]
    \centering
    \begin{subfigure}{.25\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/excel_data.png}
        \caption{Initial data}
        \label{fig: initial data}
    \end{subfigure}
    \hfill
    \begin{subfigure}{.74\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/plot_excel_data.png}
        \caption{Visual representation of the initial data}
        \label{fig: visual representation of the initial data}
    \end{subfigure}
    \caption{A look at the initial data}
\end{figure}

We define the n-th quantile as follows:
\begin{equation}
    q_n := 1 - 10^{-n}
\end{equation}
which gives $q_1 = 0.9$, $q_2 = 0.99$ ...etc. Where simply speaking $q_n$ represents ``0" followed by $n$ nines. We are mostly interested in $q_3, q_4$ and $q_5$.

\section{Bootstrap}
\label{section: bootstrap}
We use the bootstrap to estimate the value of the quantiles even with small to moderate sample size. That is, we take a random sample of a given length from our data, compute the quantile we are interested in, then repeat the process over multiple runs. \\
The results from the bootstrap are shown in figure \ref{fig: estimation of quantiles}:

\begin{figure}
    \centering
    \begin{subfigure}{.84\textwidth}
        \includegraphics[width=\textwidth]{images/estimation_q3.png}
        \caption{Estimation of $q_3$}
    \end{subfigure}
    \hfill
    \begin{subfigure}{.84\textwidth}
        \includegraphics[width=\textwidth]{images/estimation_q4.png}
        \caption{Estimation of $q_4$}
    \end{subfigure}
    \hfill
    \begin{subfigure}{.84\textwidth}
        \includegraphics[width=\textwidth]{images/estimation_q5.png}
        \caption{Estimation of $q_5$}
    \end{subfigure}
    \caption{Estimation of the quantiles over bootstrap runs}
    \label{fig: estimation of quantiles}
\end{figure}\

The plots in figure \ref{fig: estimation of quantiles} show the evolution of the quantiles as we go through the bootstraps. The grey areas represent the $95\%$ confidence intervals during that evolution. We will see how to get the confidence intervals from our histogram in section \ref{section: confidence intervals on the bootstrap}.

\textbf{According to our data}, it seems that there is close to no change in the estimation of the quantiles after $1000$ repetitions of the bootstrap. The variations are small after 500 runs already but for safety purposes we consider that we have our final guess after 1000 runs. As for the confidence intervals, only in some edge cases do we have changes past the 1000 mark. \\
\textit{NB: Our estimate of 1000 runs is based on empirical evidence. It is not a theoretical result, however, we believe that it is suitable for engineering purposes.}


\section{Confidence intervals on the bootstrap}
\label{section: confidence intervals on the bootstrap}

Let us fix a quantile that we call $q$ that we want to estimate. The bootstrap consists of two parts:

\begin{enumerate}
    \item[Part 1] Take a random sample from our original data, and determine its value for $q$.
    \item[Part 2] Take all the $q$'s that have been computed for each individual sample and deduce $q$ and its confidence interval.
\end{enumerate}\

Part 1 is fairly straightforward so we will focus on the second part.

\paragraph{Estimating the quantile} Our estimation of the quantile $q$ for the underlying distribution is simply computed by taking the average of all the $q$'s of each individual sample.

\paragraph{Computing the confidence intervals} Let's say we want to compute the $95\%$ confidence interval. To do so, we take all the $q$'s that have been computed for each individual sample and sort them. Then we take the 0.025-th quantile as our lower bound for the confidence intervals and the 0.975-th quantile as our upper bound for the confidence intervals. \\
As one may expect the values 0.025 and 0.975 are found as follows:
\[
    \frac{1 - 0.95}{2} = 0.025 \qquad \mbox{and} \qquad 1 - \frac{(1 - 0.95)}{2} = 0.975
\]
where the 0.95 comes from the $95\%$ confidence interval. \\
More generally, for a confidence level of $\gamma$ (instead of $95\%$), one has that the lower and upper bounds of the confidence interval are respectively
\[
    \gamma_{lo} := \frac{1 - \gamma}{2} \qquad \mbox{and} \qquad \gamma_{up} := 1 - \frac{(1 - \gamma)}{2}
\]

\section{Fine tuning}
Let us assume that we are working with a given data set and we have no way of getting new or more reliable data. We are trying to get the quantiles as precisely as possible and with confidence intervals as small as possible. 

There are two parameters of the bootstrap that we can adjust to meet our goals
\begin{enumerate}
    \item The size of the resamples.
    \item The number of resamples.
\end{enumerate}\

We touched on the number of resamples already in section \ref{section: bootstrap}, however we haven't dicussed the size of the resamples.




\end{document}